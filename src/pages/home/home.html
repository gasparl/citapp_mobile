<ion-header *ngIf="citP.current_div == 'div_settings'">
  <ion-toolbar>
    <ion-segment [(ngModel)]='current_segment'>
      <ion-segment-button value="menus" icon-only (tap)="pop_menu($event)">
        <ion-icon name="menu"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="main" (tap)="current_menu = '';slides.slideTo(0);citP.content.scrollToTop(0);">
        Core
      </ion-segment-button>
      <ion-segment-button value="fillers" (tap)="current_menu = '';slides.slideTo(1);citP.content.scrollToTop(0);">
        Fillers
      </ion-segment-button>
      <ion-segment-button value="settings" (tap)="current_menu = '';slides.slideTo(2);citP.content.scrollToTop(0);">
        Settings
      </ion-segment-button>
      <ion-segment-button value="autofill" (tap)="current_menu = '';slides.slideTo(3);citP.content.scrollToTop(0);">
        Storing
      </ion-segment-button>
      <ion-segment-button value="start" (tap)="current_menu = '';slides.slideTo(4);citP.content.scrollToTop(0);">
        Start
      </ion-segment-button>
    </ion-segment>

  </ion-toolbar>
</ion-header>

<ion-content padding [ngSwitch]="citP.current_div" [ngStyle]="{ 'background-color': bg_color }" text-wrap>

  <div *ngSwitchCase="'div_start'">

    <div>
      <button ion-button type="button" (tap)="citP.switch_divs('div_settings');">Start new test</button></div>

    <br /><br />
    <div>
      <button ion-button type="button">Information (brief intro with link to full README file)</button>
    </div>
    <br /><br />
    <div>
      <button ion-button type="button">Demo (%with redirect to Autofill%)</button>
    </div>
    <br /><br />
    <div>
      <button ion-button type="button">Previous results</button>
    </div>

  </div>


  <div *ngSwitchCase="'div_settings'">

    <div [hidden]="current_menu == ''" style="line-height: 150%;">

      <div [hidden]="current_menu != 'm_info'">
        <div style="font-size:110%;">
          <b>Info about this application</b>
        </div>
        <br />
        Below you find a very brief summary about the Concealed Information Test that is implemented in this app. To properly understand the test, please read the <a href="https://github.com/gasparl/citapp_pc/blob/master/README.md" target="_blank">online
          documentation</a>.
        <br /><br />
        The <i>standard</i> and <i>enhanced</i> versions aim to reveal whether or not a certain information detail – the "probe" – is known to the tested person. The "irrelevant" and "target" items must be similar to the probe, and indistinguishable
        for a person who does not know the relevance of the probe (e.g. the probe is a stolen suitcase, and the irrelevant and targets are other suitcases). In this app, the input requires no designated "irrelevant" items: all items are potential
        probes, and the real probe can be given as any of these items. In the end, all items (except the target) will each be automatically evaluated as potential probes.
        <br /><br />
        The <i>enhanced</i> version is much more effective than the <i>standard</i>; the latter is only for experimental purposes. The <i>no-target</i> version is a tentative approach in development to make the test applicable in cases where the
        probe is actually known to the participant.
        <br /><br />

      </div>

      <div [hidden]="current_menu != 'm_demo'">
        <div style="font-size:110%;">
          <b>Demo</b>
        </div>
        <br />
        For demonstration's sake, take a situation in which you want to reveal whether a person is aware of a certain date. For example, someone is suspected to be concealing the knowledge of an upcoming terrorist attack on <i>May 9</i>. In this
        case, five
        different, additional dates should be chosen randomly. For example, <i>June 14</i>, <i>December 5</i>, <i>August 25</i>, <i>February 12</i>, and <i>October 23</i>. From among these, one should be chosen randomly as target, for example, <i>August
          25</i>. These should be filled in
        accordingly on the starting page: <i>AUG 25</i> as Target, and the other dates as Probes (1-5). (In this case, the real "probe" is <i>MAY 09</i>, but the app automatically evaluates all items as potential probes.) The Subject ID could be "<i>CIT_demo_suspect_01</i>".
        <br /><br />
        All these data can be filled in automatically for a demonstration using the following button:
        <br />
        <div id="demofeed_id" style="color:white;text-align:center;">
          Demo data loaded.
        </div>
        <button ion-button type='button' (tap)="fill_demo()" color="light" block>Fill in demo data</button>
        <br />
        <hr /><br />
        If you would like to do a pilot test to see that the method truly detects a relevant detail, one good way is to enter your own personal name (e.g. family name) as one probe and, as target and other probes, enter other, randomly chosen names.
        If you then
        complete the test in the enhanced version with, say, two blocks, it is very likely that you will be detected. (Personal names are typically highly personally relevant, and thus appear highly salient in the task.) For a control test, to show
        a no effect (simulating innocence), you may enter random names for all items. Note that, in this case, the person tested should not know which item is the presumed real probe item! The mere knowledge of the
        relevance of this item (as the probe to be tested) can cause different responding.
        <br />
      </div>

      <div [hidden]="current_menu != 'm_prevs'">
        <div style="font-size:110%;">
          <b>Results of previous tests</b>
        </div>
        <br />
        List of results...

      </div>

    </div>

    <form [hidden]="current_menu != ''" (ngSubmit)="initials()" [formGroup]="form_items" (keydown.enter)="$event.preventDefault()">

      <ion-slides (ionSlideWillChange)='current_segment = seg_values[slides.getActiveIndex()];'>
        <ion-slide>

          <ion-item>
            <ion-label style="min-width:21vw;" fixed><b>Subject ID:</b></ion-label>
            <ion-input style="text-transform:none;" [(ngModel)]="citP.subj_id" formControlName="sub_id" type="text" [class.invalid]="!form_items.controls.sub_id.valid && submit_failed"></ion-input>
          </ion-item>
          <br /><br />
          <div style="font-weight:bold;font-size:130%;text-align:left;padding-left: 16px;">
            Main items in the test</div>

          <ion-item id='target'>
            <ion-label fixed>Target:</ion-label>
            <ion-input [(ngModel)]="cit_items[0]" formControlName="target" type="text" [class.invalid]="!form_items.controls.target.valid && submit_failed" (tap)="remove_img_el('target');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'target')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>


          <ion-item id='probe1'>
            <ion-label fixed>Probe 1:</ion-label>
            <ion-input [(ngModel)]="cit_items[1]" formControlName="probe1" type="text" [class.invalid]="!form_items.controls.probe1.valid && submit_failed" (tap)="remove_img_el('probe1');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'probe1')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='probe2'>
            <ion-label fixed>Probe 2:</ion-label>
            <ion-input [(ngModel)]="cit_items[2]" formControlName="probe2" type="text" [class.invalid]="!form_items.controls.probe2.valid && submit_failed" (tap)="remove_img_el('probe2');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'probe2')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='probe3'>
            <ion-label fixed>Probe 3:</ion-label>
            <ion-input [(ngModel)]="cit_items[3]" formControlName="probe3" type="text" [class.invalid]="!form_items.controls.probe3.valid && submit_failed" (tap)="remove_img_el('probe3');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'probe3')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='probe4'>
            <ion-label fixed>Probe 4:</ion-label>
            <ion-input [(ngModel)]="cit_items[4]" formControlName="probe4" type="text" [class.invalid]="!form_items.controls.probe4.valid && submit_failed" (tap)="remove_img_el('probe4');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'probe4')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='probe5'>
            <ion-label fixed>Probe 5:</ion-label>
            <ion-input [(ngModel)]="cit_items[5]" formControlName="probe5" type="text" [class.invalid]="!form_items.controls.probe5.valid && submit_failed" (tap)="remove_img_el('probe5');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'probe5')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>
          <br />
          <br />
          <button ion-button type='button' (tap)="default_core()" color="light" block>Restore default (empty)</button>
          <br />
          <span id="imgfeed_id" style="color:white;font-size:110%;"></span>
          <button ion-button type='button' (tap)="auto_img()" color="light" block>Autofill all images</button>

        </ion-slide>
        <ion-slide>

          <ion-item id='filler1'>
            <ion-label style="min-width:28vw;" fixed>Target filler 1:</ion-label>
            <ion-input [(ngModel)]="targetref_words[0]" type="text" formControlName="filler1" [class.invalid]="!form_items.controls.filler1.valid && submit_failed" (tap)="remove_img_el('filler1');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler1')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler2'>
            <ion-label style="min-width:28vw;" fixed>Target filler 2:</ion-label>
            <ion-input [(ngModel)]="targetref_words[1]" type="text" formControlName="filler2" [class.invalid]="!form_items.controls.filler2.valid && submit_failed" (tap)="remove_img_el('filler2');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler2')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler3'>
            <ion-label style="min-width:28vw;" fixed>Target filler 3:</ion-label>
            <ion-input [(ngModel)]="targetref_words[2]" type="text" formControlName="filler3" [class.invalid]="!form_items.controls.filler3.valid && submit_failed" (tap)="remove_img_el('filler3');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler3')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler4'>
            <ion-label style="min-width:28vw;" fixed>Nontarget filler 1:</ion-label>
            <ion-input [(ngModel)]="nontargref_words[0]" type="text" formControlName="filler4" [class.invalid]="!form_items.controls.filler4.valid && submit_failed" (tap)="remove_img_el('filler4');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler4')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler5'>
            <ion-label style="min-width:28vw;" fixed>Nontarget filler 2:</ion-label>
            <ion-input [(ngModel)]="nontargref_words[1]" type="text" formControlName="filler5" [class.invalid]="!form_items.controls.filler5.valid && submit_failed" (tap)="remove_img_el('filler5');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler5')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler6'>
            <ion-label style="min-width:28vw;" fixed>Nontarget filler 3:</ion-label>
            <ion-input [(ngModel)]="nontargref_words[2]" type="text" formControlName="filler6" [class.invalid]="!form_items.controls.filler6.valid && submit_failed" (tap)="remove_img_el('filler6');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler6')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler7'>
            <ion-label style="min-width:28vw;" fixed>Nontarget filler 4:</ion-label>
            <ion-input [(ngModel)]="nontargref_words[3]" type="text" formControlName="filler7" [class.invalid]="!form_items.controls.filler7.valid && submit_failed" (tap)="remove_img_el('filler7');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler7')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler8'>
            <ion-label style="min-width:28vw;" fixed>Nontarget filler 5:</ion-label>
            <ion-input [(ngModel)]="nontargref_words[4]" type="text" formControlName="filler8" [class.invalid]="!form_items.controls.filler8.valid && submit_failed" (tap)="remove_img_el('filler8');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler8')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <ion-item id='filler9'>
            <ion-label style="min-width:28vw;" fixed>Nontarget filler 6:</ion-label>
            <ion-input [(ngModel)]="nontargref_words[5]" type="text" formControlName="filler9" [class.invalid]="!form_items.controls.filler9.valid && submit_failed" (tap)="remove_img_el('filler9');"></ion-input>

            <button ion-button icon-only clear item-right (tap)="pop_imgs($event, 'filler9')">
              <ion-icon name="images" color='dark'></ion-icon>
            </button>
          </ion-item>

          <br />
          <br />
          <button ion-button type='button' (tap)="default_fillers()" color="light" block>Restore default</button>

        </ion-slide>

        <ion-slide>

          <ion-item>
            <ion-label style="margin-bottom:0;color:black">Version</ion-label>
            <ion-select [(ngModel)]="citP.cit_type" [ngModelOptions]="{standalone: true}" interface='popover' style="font-size: 3.4vw;">
              <ion-option value="0">Enhanced</ion-option>
              <ion-option value="1">Standard</ion-option>
              <ion-option value="2">No-target</ion-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label style="margin-bottom:0;color:black">Number of blocks</ion-label>
            <ion-select [(ngModel)]="citP.num_of_blocks" [ngModelOptions]="{standalone: true}" interface='popover' style="font-size: 3.4vw;">
              <ion-option value="1">1</ion-option>
              <ion-option value="2">2</ion-option>
              <ion-option value="3">3</ion-option>
              <ion-option value="4">4</ion-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label style="min-width:40vw;color:black;" fixed>Response time limit (ms)</ion-label>
            <ion-input [(ngModel)]="citP.response_deadline_main" type="number" [ngModelOptions]="{standalone: true}" style="font-style:normal;" text-right></ion-input>
          </ion-item>

          <ion-item>
            <ion-label style="min-width:65vw;color:black;" fixed>Interstimulus interval min.-max. (ms)</ion-label>
            <ion-input [(ngModel)]="citP.isi_delay_minmax[0]" type="number" [ngModelOptions]="{standalone: true}" style="font-style:normal;" text-right></ion-input>
            <ion-input [(ngModel)]="citP.isi_delay_minmax[1]" type="number" [ngModelOptions]="{standalone: true}" style="font-style:normal;" text-right></ion-input>
          </ion-item>

          <ion-item>
            <ion-label style="margin-bottom:0;color:black">Auto-transform input to uppercase</ion-label>
            <ion-toggle [(ngModel)]='texttrans' [ngModelOptions]="{standalone: true}" (ionChange)="change_texttrans();"></ion-toggle>
          </ion-item>
          <br />
          <br />
          <button ion-button type='button' (tap)="default_settings()" color="light" block>Restore default</button>

        </ion-slide>

        <ion-slide>

          <div style="font-weight:bold;font-size:130%;text-align:left;padding-left: 16px;">
            Current settings can be stored in an online database, which can be reloaded using the given Identifier and Password. (See documentation for details.)
          </div>

          <ion-item>
            <ion-label style="color:black;" fixed>Identifier</ion-label>
            <ion-input (keypress)="valid_chars2($event)" [(ngModel)]="mailpost" type="text" [ngModelOptions]="{standalone: true}" style="font-style:normal;text-transform:none;"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label style="color:black;" fixed>Password</ion-label>
            <ion-input (keypress)="valid_chars($event)" [(ngModel)]="pwpost" type="text" [ngModelOptions]="{standalone: true}" style="font-style:normal;text-transform:none;"></ion-input>
          </ion-item>

          <br />
          <span id="storefeed_id" style="font-size:110%;"></span>

          <button ion-button type='button' (tap)="settings_storage('loadit')" color="light" block>Load settings</button>

          <div *ngIf="email_valid==true">
            <br />
            <i><button style="flex-flow: column;text-transform:none;" ion-button type='button' (tap)="settings_storage('sendpass')" color="light">SEND PASSWORD TO:<br>{{email_for_pw}}</button></i>
          </div>

          <br />
          <button ion-button type='button' (tap)="settings_storage('yes')" color="light" block>Save settings online</button>

          <br />
          <hr />
          <br />

          <div style="font-weight:bold;font-size:130%;text-align:left;padding-left: 16px;">
            Local offline storage on this device will simply reload current settings whenever the app starts. (Default values remain unchanged and can be reset anytime.)
          </div>

          <span id="storefeed_id2" style="color:white;font-size:110%;">Settings were saved.</span>
          <button ion-button type='button' (tap)="store_on_device()" color="light" block>Save settings locally</button>

        </ion-slide>

        <ion-slide>
          <br /><span *ngIf="citP.subj_id != ''" style="font-size:120%">Initiate test with Subject ID <b>{{citP.subj_id}}</b>.</span>
          <br />
          <br />
          <i>
            <p *ngIf="internet_on" style="color: red;">Warning: it seems you are connected to the internet. It is best to turn it off to avoid interruptions.</p>
          </i>
          <p *ngIf="!form_items.valid && submit_failed" style="color: red;">Please fill in all necessary details.</p>
          <button ion-button type="submit">Start test</button>

        </ion-slide>


      </ion-slides>


    </form>
  </div>


  <div *ngSwitchCase="'div_instructions'">

    <ion-title>
      Instruktionen für die Aufgabe
    </ion-title>
    <p>Während der Aufgabe werden Sie im unteren Bereich des Displays zwei Schaltflächen sehen: Eine auf der <i>linken Seite</i> und eine auf der <i>rechten</i>. In diesem aktuellen Teil benutzen Sie bitte nur Ihren linken und rechten <b>{{crrnt_handpos}}</b>
      zum Antippen!
      <span [innerHTML]="task_instruction"></span></p>
    <div text-center>
      <button ion-button type="button" (tap)="citP.nextblock();">OK</button>
    </div>
  </div>


  <div *ngSwitchCase="'div_blockstart'">
    <p [innerHTML]="citP.block_texts[citP.blocknum]"></p>
    <i>(Bitte stellen Sie sicher, dass Sie Ihre <b>{{crrnt_handpos}}</b> zum Antippen benutzen.)</i><br /><br />
    <div text-center>
      <button ion-button (tap)="citP.runblock();">Start</button>
      <br /><br />
      <hr />
      <button ion-button style="text-transform: none;background-color:#5e749d;" (tap)="citP.switch_divs('div_instructions');">Anweisungen erneut anzeigen</button>
    </div>
  </div>


  <div id="div_cit_main" *ngSwitchCase="'div_cit_main'">
    <p id="feed_id"><b>{{feed_text}}</b></p>

    <p (touchstart)="citP.touchstart($event, 'resp_a');" (touchend)="citP.touchend($event, 'resp_a');" id="resp_left" class="resp_buttons"></p>

    <p (touchstart)="citP.touchstart($event, 'resp_b');" (touchend)="citP.touchend($event, 'resp_b');" id="resp_right" class="resp_buttons"></p>

    <p id="stimulus">{{stimulus_text}}</p>

    <p id="start_text" (tap)="citP.visib.start_text = false; citP.start_trials();" *ngIf="citP.visib.start_text">Tippen Sie hier, um zu beginnen.</p>
  </div>

  <div *ngSwitchCase="'div_end'">
    <header>
      <ion-navbar>
        <ion-title>
          Ende
        </ion-title>
      </ion-navbar>
    </header>
    <b>Bitte senden Sie die Daten mit folgender Taste (wählen Sie nach dem Tastendruck aus den angegebenen Applikationen Ihr Email-Programm aus):
      <div text-center>
        <button ion-button type="button" (tap)="send_mail()" style="text-transform: none;">DATEN SENDEN</button>
      </div>
      <br /> Stellen Sie sicher, dass sich eine Datei im Anhang befindet. Wenn es irgendwelche Probleme gibt, geben Sie uns Bescheid. Nach dem Versenden der Mail können Sie die Applikation beenden. Vielen Dank für Ihre Teilnahme.
    </b>
    <br />
    <br />Kurze Information über den Test:
    <br> In dieser Studie versuchen wir, Ihre wirklichen selbstbezogenen Details (z.B. Ihren tatsächlichen Vornamen) von solchen zu unterscheiden, die Ihnen nicht zugehörig sind (z.B. andere Vornamen). Ziel dieses Tests ist es, anhand von
    Reaktionszeiten
    herauszufinden, wenn eine Person versucht, bestimmte Daten zu verschleiern bzw. zu verheimlichen. Dies geschieht auf Basis der Vermutung, dass Reaktionszeiten für die Ihnen präsentierten eigenen Namen langsamer ausfallen, als im Falle anderer
    Namen. Hauptanliegen der aktuellen Studie ist es, zu zeigen, ob dies besser mit Daumen oder Zeigefinger funktioniert.
    <br><br>
    Bezüglich Ihrer Ergebnisse: Der Unterschied zwischen Ihrem eigenen Namen und den anderen Namen ist standardisiert. Dieser Wert liegt üblicherweise zwischen -1 und 5. Ist der Wert größer als 0.1, kategorisieren wir diese Person als schuldig. Ihr
    Wert liegt bei {{personal_feedback}}.

    <br><br> Falls Sie sich für die endgültigen Ergebnisse der Studie interessieren, senden Sie einfach eine Email mit dem Betreff "FEEDBACK" an die gleiche Addresse, die Sie zum Senden der Datei genutzt haben (gaspar.lukacs@univie.ac.at). Wir
    senden Ihnen dann gerne eine Kopie des resultierenden Manuskripts zu (etwa im Laufe eines halben Jahres).
    <br>Für weitere unmittelbare Informationen wenden Sie sich bitte an den Versuchsleiter.
    <br />
    <br />
    <br />
    <hr />
    <hr />
    Technical details:
    <br />
    <p style="user-select: text;white-space:pre;" [innerHTML]="to_display">
    </p>
  </div>


  <input (keypress)="onChange($event)" [(ngModel)]="to_exec" type="text" style="color:red; position:absolute;">
  <!-- app console for testing -->

</ion-content>
